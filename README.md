# Tone Markers

![The Tone Marker device](./readme-media/toneMarkerDevice.png)

## Device purpose

The purpose of the "Tone Marker" device is to translate Dual-tone multi-frequency (DTMF) tones into Transistor-transistor Logic (TTL) markers. This allows any application with an audio output (e.g. virtual reality games, websites, cellphones) to send custom markers (values ranging from 0 up to 255) by embedding DTMF tones in the audio output.

Sending markers is necessary for synchronization of recorded data (e.g. BIOPAC measurements) with VR experiences, where hardware control is not possible.

## Usage

### Setup

Internally, the Tone Marker device consists of a DTMF decoder ([MT8870 DTMF Module](https://www.tinytronics.nl/en/sensors/sound/mt8870-dtmf-module)) and a modified UsbParMarker ([UsbParMarker Version 3](https://github.com/solo-fsw/UsbParMarker)). Power is provided through a Mini-USB connection to a dedicated power source (such as a powerbank). The audio input (from e.g. the VR glasses) is fed into the DTMF decoder. Marker output is done through a Female DB25 connector, which is then connected to the required data recording device (e.g. BIOPAC, BIOSEMI).

An overview of the internal and external connections is shown below.

![An overview of the connection in / to the Tone Marker device](./readme-media/dtmf-diagram.png)

### Communication protocol

The device expects DTMF markers to start with a `*` and end with a `#`. Markers in the range of 0 to 255 can be produced. 

This means the device expects markers of the form `*55#`, which in this case results in a marker with value 55. The device will remain at value 55 until another (valid) DTMF marker is received

Requesting a marker of a value higher than 255 will result in a marker pulse of 100ms, after which the device will reset to a marker value of 0. For example, a DTMF sequence of `*256#` will result in a 100ms pulse of marker value 1.

DTMF tone sequences can be generated by using a multitude of online generators such as [this one](https://onlinesound.net/dtmf-generator) or [this one](https://www.audiocheck.net/audiocheck_dtmf.php).

## Notes

### Power supply

Some USB power adapters have some noise, which is then audible in the audio signal. In order to avoid this, the usage of a powerbank for powering the Tone Marker device is recommended.

### Volume

The DTMF decoder does not seem to work optimally (or even at all) at a volume under 75% (when testing using VR glasses). Functionality of the decoder can be checked by monitoring the red LEDs visible on the device cover. Marker functionality can be monitored by checking the green LEDs. 
